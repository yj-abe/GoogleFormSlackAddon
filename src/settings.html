<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>設定</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>

        .container {
            margin: 16px;
            display: flex;
        }

        .vertical {
            flex-direction: column;
        }

    </style>
    <script>

    </script>
</head>
<body>
<div id="progress" class="mdl-progress mdl-js-progress mdl-progress__indeterminate"></div>
<div id="panel" class="container vertical init">
    <form action="#" class="container vertical">
        <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label" id="token">
            <input class="mdl-textfield__input" type="text" id="slack_api_token" required>
            <label class="mdl-textfield__label" for="slack_api_token">Slack API トークン*</label>
        </div>
        <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label" id="channel">
            <input class="mdl-textfield__input" type="text" id="slack_channel" required>
            <label class="mdl-textfield__label" for="slack_channel">投稿先チャンネル*</label>
        </div>
        <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label" id="users">
            <input class="mdl-textfield__input" type="text" id="slack_users">
            <label class="mdl-textfield__label" for="slack_users">通知するユーザー(カンマ区切り)</label>
        </div>
    </form>
    <button id="save_btn" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent">
        保存
    </button>
</div>
<div id="toast" class="mdl-js-snackbar mdl-snackbar">
    <div class="mdl-snackbar__text"></div>
    <button class="mdl-snackbar__action" type="button"></button>
</div>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js">
</script>
<script>
    $(function () {
        $("#save_btn").click(save);
        $("#panel").hide();
        google.script.run
            .withSuccessHandler(loadSetting)
            .getSetting();
    });

    function save() {
        var settings = {
            'token': $('#slack_api_token').val(),
            'channel': $('#slack_channel').val(),
            'users': $('#slack_users').val()
        };
        google.script.run
            .withSuccessHandler(function () {
                showStatus('保存しました');
            }).saveSetting(settings);
    }
    function showStatus(msg) {
        document.querySelector('#toast')
            .MaterialSnackbar
            .showSnackbar({
                message: msg
            });
    }
    function loadSetting(settings) {
        $("#token").get(0).MaterialTextfield.change(settings.token);
        $("#channel").get(0).MaterialTextfield.change(settings.channel);
        $("#users").get(0).MaterialTextfield.change(settings.users);

        $("#progress").hide();
        $("#panel").show();
    }
</script>
</body>
</html>